<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cook County Policy Simulator (POL-681MD)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons (Core Library) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { background-color: #F8F9FA; font-family: sans-serif; }
        /* Custom scrollbar for better UX */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- LUCIDE REACT BRIDGE ---
        // This utility converts the vanilla Lucide library into React components on the fly.
        // It prevents "lucideReact is undefined" errors by dynamically creating icons.
        const LucideIcon = ({ name, size = 24, color = "currentColor", className, ...props }) => {
            const iconName = name;
            const iconDef = window.lucide && window.lucide.icons ? window.lucide.icons[iconName] : null;
            
            if (!iconDef) {
                console.warn(`Icon "${name}" not found`);
                return <span style={{width:size, height:size, display:'inline-block'}} />;
            }

            return React.createElement('svg', {
                xmlns: "http://www.w3.org/2000/svg",
                width: size,
                height: size,
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: color,
                strokeWidth: 2,
                strokeLinecap: "round",
                strokeLinejoin: "round",
                className: className,
                ...props
            }, iconDef.map(([tag, attrs], index) => 
                React.createElement(tag, { ...attrs, key: index })
            ));
        };

        // Create a proxy to handle any icon name requested (e.g., <lucideReact.Users />)
        const lucideReact = new Proxy({}, {
            get: (target, prop) => (props) => <LucideIcon name={prop} {...props} />
        });

        // Destructure icons from our proxy
        const { 
            Users, Zap, Building2, MessageSquare, ArrowRight, FileText, 
            CheckCircle2, AlertTriangle, Loader2, Gavel, RefreshCw, 
            TrendingUp, ShieldAlert, Sprout, BookOpen, Scale, 
            LayoutDashboard, Plus, ChevronDown, ChevronUp, ExternalLink, 
            Bot, HardHat, Droplets, GitPullRequest, Search, MessageCircle, 
            HelpCircle, X, PenTool, ClipboardCopy, Download, PlayCircle,
            Settings, Key
        } = lucideReact;

        /* --- DEMO DATA --- */
        const DEMO_PROPOSAL = "Mandate that all new data centers over 50MW in Cook County must source 100% of their electricity from NEW local renewable energy projects (additionality) within 5 years of operation.";

        const DEMO_RESULT = {
            responses: [
                { 
                    id: "env_dept", 
                    stance: "approval", 
                    score: 95, 
                    content: "This 'additionality' clause is the gold standard. It prevents companies from just buying cheap RECs from Texas while polluting here. It aligns perfectly with the Cook County Clean Energy Plan.", 
                    notes: "This is exactly what we need to hit our 2030 targets. No loopholes.", 
                    resources: [{ title: "Cook County Clean Energy Plan (2024)", type: "Plan" }] 
                },
                { 
                    id: "perro", 
                    stance: "skeptical", 
                    score: 45, 
                    content: "Clean energy is good, but where are these solar farms going? If they put them on brownfields in our neighborhood without cleaning them up first, we object. We also need to ensure residential rates don't hike up to pay for this infrastructure.", 
                    notes: "Rich tech companies get solar, we get the bill? Need price protections.", 
                    resources: [{ title: "Grid Equity Report", type: "Study" }] 
                },
                { 
                    id: "ibew", 
                    stance: "approval", 
                    score: 90, 
                    content: "Building new local wind and solar infrastructure means thousands of man-hours for Local 134. We support this 100%, provided the construction is Project Labor Agreement (PLA) mandated.", 
                    notes: "Green energy = Green backs. As long as it's union built.", 
                    resources: [{ title: "IBEW Renewable Energy Training", type: "Standard" }] 
                },
                { 
                    id: "econ_dev", 
                    stance: "objection", 
                    score: 30, 
                    content: "The 5-year timeline is unrealistic. Indiana offers 100% dirty power for 40% less cost. We will lose the next 3 hyperscale bids immediately. We need a 10-year ramp or tax offsets.", 
                    notes: "We are going to lose the Amazon HQ2 equivalent of data centers if we do this.", 
                    resources: [{ title: "Regional Competitiveness Index", type: "Data" }] 
                }
            ],
            conflict: "Environmental Integrity (Additionality) vs. Regional Economic Competitiveness.",
            synthesis: "EDUCATIONAL SYNTHESIS:\n\nThe core tension is between the Environmental Department's need for 'real' zero-carbon energy and the Economic Bureau's fear of losing bids to Indiana.\n\nPOSSIBLE STRATEGIES FOR STUDENT:\n1. Keep the mandate but extend the timeline to 7-10 years (Compromise).\n2. Keep the 5-year timeline but offer heavier tax incentives to offset the cost difference (Economic appeasement).\n3. Stand firm on 5 years, arguing that 'Green Premium' attracts top-tier tech firms (Brand argument)."
        };

        const STAKEHOLDERS = [
            { id: "env_dept", role: "Cook County Dept. of Environment", icon: "policy", desc: "Focus: Climate Action Plan, Energy, Water & Carbon Neutrality", defaultModel: "Gemini 2.5 Pro (Gov)" },
            { id: "perro", role: "PERRO (Community Organizer)", icon: "community", desc: "Focus: Environmental Justice, Pilsen, Air Quality, Equity", defaultModel: "Gemini 2.5 Flash (Civic)" },
            { id: "ibew", role: "IBEW Union Rep", icon: "union", desc: "Focus: Skilled Trades, Construction Jobs, Worker Safety", defaultModel: "Gemini 2.5 Flash (Labor)" },
            { id: "econ_dev", role: "Economic Development Bureau", icon: "growth", desc: "Focus: Tax Base, Tech Hub Status, Regional Competitiveness", defaultModel: "Gemini 2.5 Pro (Finance)" }
        ];

        const MOCK_HISTORY = [
            {
                id: 1,
                title: "South Side Water Cooling Restrictions",
                date: "2024-03-15",
                status: "Passed",
                summary: "Restricts potable water use for data center cooling in residential zones. Mandates greywater recycling systems for facilities >50MW.",
                synthesis: "COORDINATOR SUMMARY:\n\nPolicy PASSED. The tension between the IBEW's desire for rapid construction and PERRO's concern for community resources was resolved via the greywater mandate.\n\nOUTCOME: Creates more complex plumbing jobs (Win for IBEW) while protecting Lake Michigan freshwater (Win for Environment).",
                responses: [
                    { id: "env_dept", stance: "approval", score: 90, content: "Aligned with our 2030 Clean Water goals. We cannot allow drinking water to be evaporated for server cooling when the lake levels are fluctuating.", notes: "Finally, a policy that respects the Great Lakes Compact.", resources: [{ title: "Cook County Water Management Plan", type: "Plan" }] },
                    { id: "perro", stance: "approval", score: 95, content: "Our neighborhoods already suffer from lead pipes. We shouldn't be prioritizing clean water for machines over people.", notes: "This is a basic equity issue.", resources: [{ title: "The People Say No Toolkit", type: "Toolkit" }] },
                    { id: "ibew", stance: "neutral", score: 60, content: "Using greywater systems is fine, it actually increases the work hours for our pipefitters. Just don't make the permitting take 3 years.", notes: "More complex systems = more work for us. I'll take it.", resources: [] },
                    { id: "econ_dev", stance: "objection", score: 40, content: "This adds 15% to initial CAPEX for developers. We might lose the Google project to Indiana where water is unregulated.", notes: "Indiana is going to eat our lunch on costs.", resources: [{ title: "Baxtel Data Center Rankings", type: "Data" }] }
                ]
            }
        ];

        // --- SUB-COMPONENTS ---

        const Header = ({ setView, setShowHelp, setShowSettings }) => (
            <header className="bg-white border-b-2 border-black sticky top-0 z-20">
                <div className="max-w-7xl mx-auto px-4 h-20 flex items-center justify-between">
                    <div className="flex items-center gap-3 cursor-pointer group" onClick={() => setView('landing')}>
                        <div className="w-12 h-12 bg-[#00A3E0] flex items-center justify-center border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] transition-transform group-hover:translate-y-1 group-hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]">
                            <Building2 className="w-7 h-7 text-white" />
                        </div>
                        <div>
                            <h1 className="font-bold text-xl tracking-tight leading-none text-black">COOK<span className="text-[#00A3E0]">SIMULATOR</span></h1>
                            <p className="text-xs font-mono font-medium text-gray-500 mt-1">POL-681MD: Stakeholder Perspective Tool</p>
                        </div>
                    </div>
                    <nav className="flex items-center gap-6">
                        <button onClick={() => setShowSettings(true)} className="flex items-center gap-2 text-sm font-bold text-gray-600 hover:text-black transition-colors">
                            <Settings className="w-4 h-4" /> Settings
                        </button>
                        <button onClick={() => setShowHelp(true)} className="flex items-center gap-2 text-sm font-bold text-gray-600 hover:text-black transition-colors">
                            <HelpCircle className="w-4 h-4" /> How to Use
                        </button>
                        <div className="h-6 w-px bg-gray-300 hidden md:block"></div>
                        <button onClick={() => setView('landing')} className="hidden md:flex items-center gap-2 text-sm font-bold hover:text-[#00A3E0] transition-colors">
                            <LayoutDashboard className="w-4 h-4" /> Case Studies
                        </button>
                    </nav>
                </div>
            </header>
        );

        const SettingsModal = ({ apiKey, setApiKey, onClose }) => (
            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in duration-200">
                <div className="bg-white max-w-md w-full rounded-xl shadow-2xl border-2 border-black overflow-hidden flex flex-col">
                    <div className="p-4 border-b border-gray-200 flex justify-between items-center bg-[#F8F9FA]">
                        <h2 className="text-lg font-black flex items-center gap-2">
                            <Settings className="w-5 h-5 text-[#00A3E0]" /> Settings
                        </h2>
                        <button onClick={onClose} className="p-1 hover:bg-gray-200 rounded-lg transition-colors"><X className="w-5 h-5" /></button>
                    </div>
                    <div className="p-6 space-y-4">
                        <div>
                            <label className="block text-sm font-bold mb-2 flex items-center gap-2">
                                <Key className="w-4 h-4" /> Gemini API Key
                            </label>
                            <input
                                type="password"
                                value={apiKey}
                                onChange={(e) => setApiKey(e.target.value)}
                                placeholder="AIzaSy..."
                                className="w-full bg-[#F0F4F8] border-2 border-gray-300 p-3 text-sm focus:border-[#00A3E0] outline-none"
                            />
                            <p className="text-xs text-gray-500 mt-2">
                                Enter your own Gemini API key to run live simulations. Leave blank to use Demo Mode.
                            </p>
                        </div>
                    </div>
                    <div className="p-4 border-t border-gray-200 bg-gray-50 flex justify-end">
                        <button onClick={onClose} className="bg-black text-white px-6 py-2 font-bold hover:bg-[#00A3E0] transition-colors">Save & Close</button>
                    </div>
                </div>
            </div>
        );

        const HelpModal = ({ onClose }) => (
            <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in duration-200">
                <div className="bg-white max-w-2xl w-full rounded-xl shadow-2xl border-2 border-black overflow-hidden flex flex-col max-h-[90vh]">
                    <div className="p-6 border-b border-gray-200 flex justify-between items-center bg-[#F8F9FA]">
                        <div>
                            <h2 className="text
